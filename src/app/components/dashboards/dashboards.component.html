<div class="dashboards-container">
  <!-- Header -->
  <header class="dashboards-header">
    <div class="header-left">
      <button mat-icon-button class="back-btn" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <img src="assets/images/mikhuy-logo.png" alt="MIKHUY Logo" class="header-logo">
    </div>

    <div class="header-center">
      <button mat-raised-button class="dashboard-btn">
        <mat-icon>bar_chart</mat-icon>
        DASHBOARDS
      </button>
    </div>

    <div class="header-right">
      <button mat-icon-button class="icon-btn notifications-btn" [matMenuTriggerFor]="notificationMenu">
        <mat-icon [matBadge]="notificationCount" [matBadgeHidden]="notificationCount === 0" matBadgeColor="warn">notifications</mat-icon>
      </button>

      <mat-menu #notificationMenu="matMenu" class="notification-menu">
        <div class="notification-header">
          <h3>Progreso de Estudiantes</h3>
        </div>
        <div class="notification-content">
          <div class="empty-notifications">
            <mat-icon>notifications_off</mat-icon>
            <p>No hay actualizaciones</p>
          </div>
        </div>
      </mat-menu>

      <button mat-icon-button class="icon-btn" [matMenuTriggerFor]="menu">
        <mat-icon>menu</mat-icon>
      </button>

      <mat-menu #menu="matMenu" class="user-menu">
        <button mat-menu-item (click)="openProfile()">
          <mat-icon>person</mat-icon>
          <span>Perfil</span>
        </button>
        <button mat-menu-item (click)="logout()">
          <mat-icon>logout</mat-icon>
          <span>Salir</span>
        </button>
      </mat-menu>
    </div>
  </header>

  <!-- Main Content -->
  <div class="dashboards-content">
    
    <!-- Sidebar con lista de estudiantes -->
    <div class="sidebar">
      <!-- Search -->
      <div class="search-box">
        <mat-icon>search</mat-icon>
        <input type="text" 
               placeholder="Buscar nombre" 
               [value]="searchQuery"
               (input)="searchQuery=$any($event.target).value; searchStudents()">
      </div>

      <!-- Student List -->
      <mat-list class="student-list">
        <mat-list-item *ngFor="let student of filteredStudents" 
                       [class.active]="selectedStudent?.id === student.id"
                       (click)="selectStudent(student)">
          <div class="student-item">
            <div class="student-avatar">
              <img [src]="getAvatarUrl(student)" 
                   [alt]="student.nombre"
                   (error)="onAvatarError($event)">
              <mat-icon *ngIf="!student.avatar">account_circle</mat-icon>
            </div>
            <div class="student-info">
              <h4>{{student.nombre}} {{student.apellido}}</h4>
              <p>{{student.grado}} - Sección {{student.seccion}}</p>
            </div>
          </div>
        </mat-list-item>
      </mat-list>
    </div>

    <!-- Dashboard Content -->
    <div class="dashboard-main" *ngIf="selectedStudent">
      
      <!-- Student Profile Card -->
      <mat-card class="profile-summary">
        <div class="profile-content">
          <div class="profile-avatar">
            <img [src]="getAvatarUrl(selectedStudent)" 
                 [alt]="selectedStudent.nombre"
                 (error)="onAvatarError($event)">
            <mat-icon *ngIf="!selectedStudent.avatar">account_circle</mat-icon>
          </div>
          <div class="profile-details">
            <h2>{{selectedStudent.nombre}} {{selectedStudent.apellido}}</h2>
            <div class="profile-stats">
              <div class="stat-item">
                <span class="label">Edad:</span>
                <span class="value">{{selectedStudent.edad}}</span>
              </div>
              <div class="stat-item">
                <span class="label">Talla:</span>
                <span class="value">{{selectedStudent.talla}}</span>
              </div>
              <div class="stat-item">
                <span class="label">Peso:</span>
                <span class="value">{{selectedStudent.peso}}</span>
              </div>
              <div class="stat-item">
                <span class="label">Grado:</span>
                <span class="value">{{selectedStudent.grado}} - {{selectedStudent.seccion}}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="profile-actions">
          <button mat-raised-button class="download-btn" (click)="descargarReporte()">
            <mat-icon>download</mat-icon>
            Descargar reporte
          </button>
          <button mat-raised-button class="email-btn" (click)="enviarCorreo()">
            <mat-icon>email</mat-icon>
            Enviar por correo
          </button>
        </div>
      </mat-card>

      <!-- Charts Grid -->
      <div class="charts-grid">
        
        <!-- Gráfico 1: Conocimiento Nutricional -->
        <mat-card class="chart-card" *ngIf="selectedStudent && selectedStudent.gameData">
          <mat-card-header>
            <mat-icon class="info-icon" matTooltip="Resultados del Desafío Nutrimental">info</mat-icon>
            <mat-card-title>Conocimiento Nutricional</mat-card-title>
            <span class="data-source">Datos del Desafío Nutrimental</span>
          </mat-card-header>
          <mat-card-content>
            <div class="chart-container">
              <div class="knowledge-stats">
                <div class="stat-circle">
                  <svg viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="40" class="stat-bg"/>
                    <circle cx="50" cy="50" r="40" class="stat-progress"
                            [attr.stroke-dasharray]="(selectedStudent.gameData!.nutrimental.porcentajeAciertos * 2.51) + ' 251'"
                            [style.stroke]="selectedStudent.gameData!.nutrimental.porcentajeAciertos >= 80 ? '#7BC67E' : selectedStudent.gameData!.nutrimental.porcentajeAciertos >= 60 ? '#FFB74D' : '#f44336'"/>
                    <text x="50" y="55" class="stat-text">{{selectedStudent.gameData!.nutrimental.porcentajeAciertos}}%</text>
                  </svg>
                  <p>Aciertos</p>
                </div>
                <div class="knowledge-details">
                  <div class="detail-item">
                    <mat-icon>emoji_events</mat-icon>
                    <div>
                      <strong>Nivel {{selectedStudent.gameData!.nutrimental.nivelActual}}/10</strong>
                      <span>{{selectedStudent.gameData!.nutrimental.puntosGanados}} puntos</span>
                    </div>
                  </div>
                  <div class="detail-item">
                    <mat-icon>schedule</mat-icon>
                    <div>
                      <strong>Último juego</strong>
                      <span>{{selectedStudent.gameData!.nutrimental.ultimoJuego}}</span>
                    </div>
                  </div>
                  <div class="detail-item" *ngIf="selectedStudent.gameData!.nutrimental.temasDebiles.length > 0">
                    <mat-icon>lightbulb</mat-icon>
                    <div>
                      <strong>Temas a reforzar</strong>
                      <span>{{selectedStudent.gameData!.nutrimental.temasDebiles.join(', ')}}</span>
                    </div>
                  </div>
                  <div class="detail-item success" *ngIf="selectedStudent.gameData!.nutrimental.temasDebiles.length === 0">
                    <mat-icon>check_circle</mat-icon>
                    <div>
                      <strong>¡Excelente!</strong>
                      <span>Domina todos los temas</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Gráfico 2: Distribución de Macronutrientes -->
        <mat-card class="chart-card" *ngIf="selectedStudent && selectedStudent.gameData">
          <mat-card-header>
            <mat-card-title>Distribución de Macronutrientes</mat-card-title>
            <span class="data-source">Datos del Reto 7 Días</span>
          </mat-card-header>
          <mat-card-content>
            <div class="chart-container">
              <svg viewBox="0 0 200 200" class="donut-chart">
                <!-- Proteínas -->
                <circle cx="100" cy="100" r="60" class="donut-segment protein"
                        [attr.stroke-dasharray]="getCircleSegment(selectedStudent.gameData!.macronutrientes.proteinas) + ' 300'"/>
                <!-- Carbohidratos -->
                <circle cx="100" cy="100" r="60" class="donut-segment carbs"
                        [attr.stroke-dasharray]="getCircleSegment(selectedStudent.gameData!.macronutrientes.carbohidratos) + ' 300'"
                        [attr.stroke-dashoffset]="-getCircleSegment(selectedStudent.gameData!.macronutrientes.proteinas)"/>
                <!-- Grasas -->
                <circle cx="100" cy="100" r="60" class="donut-segment fat"
                        [attr.stroke-dasharray]="getCircleSegment(selectedStudent.gameData!.macronutrientes.grasas) + ' 300'"
                        [attr.stroke-dashoffset]="-(getCircleSegment(selectedStudent.gameData!.macronutrientes.proteinas) + getCircleSegment(selectedStudent.gameData!.macronutrientes.carbohidratos))"/>
                
                <text x="100" y="105" class="donut-center">100%</text>
              </svg>
              <div class="chart-legend">
                <div class="legend-item">
                  <span class="legend-color protein-color"></span>
                  <span>Proteínas {{selectedStudent.gameData!.macronutrientes.proteinas}}%</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color carbs-color"></span>
                  <span>Carbohidratos {{selectedStudent.gameData!.macronutrientes.carbohidratos}}%</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color fat-color"></span>
                  <span>Grasas {{selectedStudent.gameData!.macronutrientes.grasas}}%</span>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Gráfico 3: Etapa de Cambio (Coach Exprés) -->
        <mat-card class="chart-card" *ngIf="selectedStudent && selectedStudent.gameData">
          <mat-card-header>
            <mat-card-title>Etapa de Cambio Conductual</mat-card-title>
            <span class="data-source">Datos del Coach Exprés</span>
          </mat-card-header>
          <mat-card-content>
            <div class="chart-container">
              <div class="stage-indicator">
                <div class="stage-circle" [class.active]="selectedStudent.gameData!.coachExpres.etapaActual === 'Pre-contemplación'">
                  <span class="stage-number">1</span>
                  <p>Pre-contemplación</p>
                </div>
                <div class="stage-connector" [class.active]="['Contemplación', 'Preparación', 'Acción', 'Mantenimiento'].includes(selectedStudent.gameData!.coachExpres.etapaActual)"></div>
                <div class="stage-circle" [class.active]="selectedStudent.gameData!.coachExpres.etapaActual === 'Contemplación'">
                  <span class="stage-number">2</span>
                  <p>Contemplación</p>
                </div>
                <div class="stage-connector" [class.active]="['Preparación', 'Acción', 'Mantenimiento'].includes(selectedStudent.gameData!.coachExpres.etapaActual)"></div>
                <div class="stage-circle" [class.active]="selectedStudent.gameData!.coachExpres.etapaActual === 'Preparación'">
                  <span class="stage-number">3</span>
                  <p>Preparación</p>
                </div>
                <div class="stage-connector" [class.active]="['Acción', 'Mantenimiento'].includes(selectedStudent.gameData!.coachExpres.etapaActual)"></div>
                <div class="stage-circle" [class.active]="selectedStudent.gameData!.coachExpres.etapaActual === 'Acción'">
                  <span class="stage-number">4</span>
                  <p>Acción</p>
                </div>
                <div class="stage-connector" [class.active]="selectedStudent.gameData!.coachExpres.etapaActual === 'Mantenimiento'"></div>
                <div class="stage-circle" [class.active]="selectedStudent.gameData!.coachExpres.etapaActual === 'Mantenimiento'">
                  <span class="stage-number">5</span>
                  <p>Mantenimiento</p>
                </div>
              </div>
              <div class="motivation-score">
                <mat-icon>psychology</mat-icon>
                <div>
                  <strong>Motivación: {{selectedStudent.gameData!.coachExpres.puntajeMotivacion}}/5.0</strong>
                  <p>Disposición al cambio: {{selectedStudent.gameData!.coachExpres.disposicionCambio}}/5</p>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Tabla: Frutas y Verduras -->
        <mat-card class="chart-card table-card" *ngIf="selectedStudent && selectedStudent.gameData">
          <mat-card-header>
            <mat-card-title>Consumo de Grupos Alimenticios</mat-card-title>
            <span class="data-source">Datos del Reto 7 Días</span>
          </mat-card-header>
          <mat-card-content>
            <div class="data-table">
              <div class="table-row">
                <span class="food-label">Frutas:</span>
                <div class="color-bar green-bar" [style.width.%]="(selectedStudent.gameData!.reto7Dias.alimentosPorGrupo.frutas / 7) * 100"></div>
                <span>{{selectedStudent.gameData!.reto7Dias.alimentosPorGrupo.frutas}}</span>
              </div>
              <div class="table-row">
                <span class="food-label">Verduras:</span>
                <div class="color-bar green-bar" [style.width.%]="(selectedStudent.gameData!.reto7Dias.alimentosPorGrupo.verduras / 7) * 100"></div>
                <span>{{selectedStudent.gameData!.reto7Dias.alimentosPorGrupo.verduras}}</span>
              </div>
              <div class="table-row">
                <span class="food-label">Lácteos:</span>
                <div class="color-bar yellow-bar" [style.width.%]="(selectedStudent.gameData!.reto7Dias.alimentosPorGrupo.lacteos / 7) * 100"></div>
                <span>{{selectedStudent.gameData!.reto7Dias.alimentosPorGrupo.lacteos}}</span>
              </div>
              <div class="table-row">
                <span class="food-label">Dulces:</span>
                <div class="color-bar red-bar" [style.width.%]="(selectedStudent.gameData!.reto7Dias.alimentosPorGrupo.dulces / 7) * 100"></div>
                <span>{{selectedStudent.gameData!.reto7Dias.alimentosPorGrupo.dulces}}</span>
              </div>
            </div>
            <p class="table-footer">Promedio en 7 días</p>
          </mat-card-content>
        </mat-card>

        <!-- Gráfico 5: Ingesta Semanal de Agua -->
        <mat-card class="chart-card" *ngIf="selectedStudent && selectedStudent.gameData">
          <mat-card-header>
            <mat-card-title>Registro de Emociones al Comer</mat-card-title>
            <span class="data-source">Datos del Reto 7 Días</span>
          </mat-card-header>
          <mat-card-content>
            <div class="chart-container">
              <div class="emotion-bars">
                <div class="emotion-item">
                  <span class="emotion-emoji">😊</span>
                  <div class="emotion-bar-bg">
                    <div class="emotion-bar happy" [style.width.%]="(selectedStudent.gameData!.reto7Dias.emocionesAlComer.feliz / 21) * 100"></div>
                  </div>
                  <span class="emotion-count">{{selectedStudent.gameData!.reto7Dias.emocionesAlComer.feliz}}</span>
                </div>
                <div class="emotion-item">
                  <span class="emotion-emoji">😐</span>
                  <div class="emotion-bar-bg">
                    <div class="emotion-bar normal" [style.width.%]="(selectedStudent.gameData!.reto7Dias.emocionesAlComer.normal / 21) * 100"></div>
                  </div>
                  <span class="emotion-count">{{selectedStudent.gameData!.reto7Dias.emocionesAlComer.normal}}</span>
                </div>
                <div class="emotion-item">
                  <span class="emotion-emoji">😢</span>
                  <div class="emotion-bar-bg">
                    <div class="emotion-bar sad" [style.width.%]="(selectedStudent.gameData!.reto7Dias.emocionesAlComer.triste / 21) * 100"></div>
                  </div>
                  <span class="emotion-count">{{selectedStudent.gameData!.reto7Dias.emocionesAlComer.triste}}</span>
                </div>
                <div class="emotion-item">
                  <span class="emotion-emoji">😰</span>
                  <div class="emotion-bar-bg">
                    <div class="emotion-bar stressed" [style.width.%]="(selectedStudent.gameData!.reto7Dias.emocionesAlComer.estresado / 21) * 100"></div>
                  </div>
                  <span class="emotion-count">{{selectedStudent.gameData!.reto7Dias.emocionesAlComer.estresado}}</span>
                </div>
                <div class="emotion-item">
                  <span class="emotion-emoji">😬</span>
                  <div class="emotion-bar-bg">
                    <div class="emotion-bar anxious" [style.width.%]="(selectedStudent.gameData!.reto7Dias.emocionesAlComer.ansioso / 21) * 100"></div>
                  </div>
                  <span class="emotion-count">{{selectedStudent.gameData!.reto7Dias.emocionesAlComer.ansioso}}</span>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Gráfico 6: Concentración Vitaminas y Minerales -->
        <mat-card class="chart-card" *ngIf="selectedStudent && selectedStudent.gameData">
          <mat-card-header>
            <mat-card-title>Concentración Vitaminas y Minerales</mat-card-title>
            <span class="data-source">Calculado del Reto 7 Días</span>
          </mat-card-header>
          <mat-card-content>
            <div class="chart-container">
              <div class="vitamin-bars">
                <div class="vitamin-item">
                  <span class="vitamin-label">Vitamina A</span>
                  <div class="vitamin-bar-container">
                    <div class="vitamin-bar" [style.width.%]="selectedStudent.gameData!.vitaminas.vitaminaA"
                         [class.good]="selectedStudent.gameData!.vitaminas.vitaminaA >= 80"
                         [class.medium]="selectedStudent.gameData!.vitaminas.vitaminaA >= 60 && selectedStudent.gameData!.vitaminas.vitaminaA < 80"
                         [class.low]="selectedStudent.gameData!.vitaminas.vitaminaA < 60"></div>
                  </div>
                  <span class="vitamin-value">{{selectedStudent.gameData!.vitaminas.vitaminaA}}%</span>
                </div>
                <div class="vitamin-item">
                  <span class="vitamin-label">Vitamina C</span>
                  <div class="vitamin-bar-container">
                    <div class="vitamin-bar" [style.width.%]="selectedStudent.gameData!.vitaminas.vitaminaC"
                         [class.good]="selectedStudent.gameData!.vitaminas.vitaminaC >= 80"
                         [class.medium]="selectedStudent.gameData!.vitaminas.vitaminaC >= 60 && selectedStudent.gameData!.vitaminas.vitaminaC < 80"
                         [class.low]="selectedStudent.gameData!.vitaminas.vitaminaC < 60"></div>
                  </div>
                  <span class="vitamin-value">{{selectedStudent.gameData!.vitaminas.vitaminaC}}%</span>
                </div>
                <div class="vitamin-item">
                  <span class="vitamin-label">Calcio</span>
                  <div class="vitamin-bar-container">
                    <div class="vitamin-bar" [style.width.%]="selectedStudent.gameData!.vitaminas.calcio"
                         [class.good]="selectedStudent.gameData!.vitaminas.calcio >= 80"
                         [class.medium]="selectedStudent.gameData!.vitaminas.calcio >= 60 && selectedStudent.gameData!.vitaminas.calcio < 80"
                         [class.low]="selectedStudent.gameData!.vitaminas.calcio < 60"></div>
                  </div>
                  <span class="vitamin-value">{{selectedStudent.gameData!.vitaminas.calcio}}%</span>
                </div>
                <div class="vitamin-item">
                  <span class="vitamin-label">Hierro</span>
                  <div class="vitamin-bar-container">
                    <div class="vitamin-bar" [style.width.%]="selectedStudent.gameData!.vitaminas.hierro"
                         [class.good]="selectedStudent.gameData!.vitaminas.hierro >= 80"
                         [class.medium]="selectedStudent.gameData!.vitaminas.hierro >= 60 && selectedStudent.gameData!.vitaminas.hierro < 80"
                         [class.low]="selectedStudent.gameData!.vitaminas.hierro < 60"></div>
                  </div>
                  <span class="vitamin-value">{{selectedStudent.gameData!.vitaminas.hierro}}%</span>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
          <mat-card-header>
            <mat-card-title>Distribución de Macronutrientes</mat-card-title>
            <span class="data-source">Datos del Reto 7 Días</span>
          </mat-card-header>
          <mat-card-content>
            <div class="chart-container">
              <svg viewBox="0 0 200 200" class="donut-chart">
                <!-- Proteínas -->
                <circle cx="100" cy="100" r="60" class="donut-segment protein"
                        [attr.stroke-dasharray]="getCircleSegment(selectedStudent.gameData.macronutrientes.proteinas) + ' 300'"/>
                <!-- Carbohidratos -->
                <circle cx="100" cy="100" r="60" class="donut-segment carbs"
                        [attr.stroke-dasharray]="getCircleSegment(selectedStudent.gameData.macronutrientes.carbohidratos) + ' 300'"
                        [attr.stroke-dashoffset]="-getCircleSegment(selectedStudent.gameData.macronutrientes.proteinas)"/>
                <!-- Grasas -->
                <circle cx="100" cy="100" r="60" class="donut-segment fat"
                        [attr.stroke-dasharray]="getCircleSegment(selectedStudent.gameData.macronutrientes.grasas) + ' 300'"
                        [attr.stroke-dashoffset]="-(getCircleSegment(selectedStudent.gameData.macronutrientes.proteinas) + getCircleSegment(selectedStudent.gameData.macronutrientes.carbohidratos))"/>
                
                <text x="100" y="105" class="donut-center">100%</text>
              </svg>
              <div class="chart-legend">
                <div class="legend-item">
                  <span class="legend-color protein-color"></span>
                  <span>Proteínas {{selectedStudent.gameData.macronutrientes.proteinas}}%</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color carbs-color"></span>
                  <span>Carbohidratos {{selectedStudent.gameData.macronutrientes.carbohidratos}}%</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color fat-color"></span>
                  <span>Grasas {{selectedStudent.gameData.macronutrientes.grasas}}%</span>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Gráfico 3: Etapa de Cambio (Coach Exprés) -->
        <mat-card class="chart-card" *ngIf="selectedStudent.gameData">
          <mat-card-header>
            <mat-card-title>Etapa de Cambio Conductual</mat-card-title>
            <span class="data-source">Datos del Coach Exprés</span>
          </mat-card-header>
          <mat-card-content>
            <div class="chart-container">
              <div class="stage-indicator">
                <div class="stage-circle" [class.active]="selectedStudent.gameData.coachExpres.etapaActual === 'Pre-contemplación'">
                  <span class="stage-number">1</span>
                  <p>Pre-contemplación</p>
                </div>
                <div class="stage-connector" [class.active]="['Contemplación', 'Preparación', 'Acción', 'Mantenimiento'].includes(selectedStudent.gameData.coachExpres.etapaActual)"></div>
                <div class="stage-circle" [class.active]="selectedStudent.gameData.coachExpres.etapaActual === 'Contemplación'">
                  <span class="stage-number">2</span>
                  <p>Contemplación</p>
                </div>
                <div class="stage-connector" [class.active]="['Preparación', 'Acción', 'Mantenimiento'].includes(selectedStudent.gameData.coachExpres.etapaActual)"></div>
                <div class="stage-circle" [class.active]="selectedStudent.gameData.coachExpres.etapaActual === 'Preparación'">
                  <span class="stage-number">3</span>
                  <p>Preparación</p>
                </div>
                <div class="stage-connector" [class.active]="['Acción', 'Mantenimiento'].includes(selectedStudent.gameData.coachExpres.etapaActual)"></div>
                <div class="stage-circle" [class.active]="selectedStudent.gameData.coachExpres.etapaActual === 'Acción'">
                  <span class="stage-number">4</span>
                  <p>Acción</p>
                </div>
                <div class="stage-connector" [class.active]="selectedStudent.gameData.coachExpres.etapaActual === 'Mantenimiento'"></div>
                <div class="stage-circle" [class.active]="selectedStudent.gameData.coachExpres.etapaActual === 'Mantenimiento'">
                  <span class="stage-number">5</span>
                  <p>Mantenimiento</p>
                </div>
              </div>
              <div class="motivation-score">
                <mat-icon>psychology</mat-icon>
                <div>
                  <strong>Motivación: {{selectedStudent.gameData.coachExpres.puntajeMotivacion}}/5.0</strong>
                  <p>Disposición al cambio: {{selectedStudent.gameData.coachExpres.disposicionCambio}}/5</p>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Tabla: Frutas y Verduras -->
        <mat-card class="chart-card table-card" *ngIf="selectedStudent.gameData">
          <mat-card-header>
            <mat-card-title>Consumo de Grupos Alimenticios</mat-card-title>
            <span class="data-source">Datos del Reto 7 Días</span>
          </mat-card-header>
          <mat-card-content>
            <div class="data-table">
              <div class="table-row">
                <span class="food-label">Frutas:</span>
                <div class="color-bar green-bar" [style.width.%]="(selectedStudent.gameData.reto7Dias.alimentosPorGrupo.frutas / 7) * 100"></div>
                <span>{{selectedStudent.gameData.reto7Dias.alimentosPorGrupo.frutas}}</span>
              </div>
              <div class="table-row">
                <span class="food-label">Verduras:</span>
                <div class="color-bar green-bar" [style.width.%]="(selectedStudent.gameData.reto7Dias.alimentosPorGrupo.verduras / 7) * 100"></div>
                <span>{{selectedStudent.gameData.reto7Dias.alimentosPorGrupo.verduras}}</span>
              </div>
              <div class="table-row">
                <span class="food-label">Lácteos:</span>
                <div class="color-bar yellow-bar" [style.width.%]="(selectedStudent.gameData.reto7Dias.alimentosPorGrupo.lacteos / 7) * 100"></div>
                <span>{{selectedStudent.gameData.reto7Dias.alimentosPorGrupo.lacteos}}</span>
              </div>
              <div class="table-row">
                <span class="food-label">Dulces:</span>
                <div class="color-bar red-bar" [style.width.%]="(selectedStudent.gameData.reto7Dias.alimentosPorGrupo.dulces / 7) * 100"></div>
                <span>{{selectedStudent.gameData.reto7Dias.alimentosPorGrupo.dulces}}</span>
              </div>
            </div>
            <p class="table-footer">Promedio en 7 días</p>
          </mat-card-content>
        </mat-card>="table-row">
                <div class="color-bar red-bar"></div>
                <span>1</span>
              </div>
            </div>
            <p class="table-footer">Azúcares Añadidos</p>
          </mat-card-content>
        </mat-card>

        <!-- Gráfico 5: Ingesta Semanal de Agua -->
        <mat-card class="chart-card" *ngIf="selectedStudent.gameData">
          <mat-card-header>
            <mat-card-title>Registro de Emociones al Comer</mat-card-title>
            <span class="data-source">Datos del Reto 7 Días</span>
          </mat-card-header>
          <mat-card-content>
            <div class="chart-container">
              <div class="emotion-bars">
                <div class="emotion-item">
                  <span class="emotion-emoji">😊</span>
                  <div class="emotion-bar-bg">
                    <div class="emotion-bar happy" [style.width.%]="(selectedStudent.gameData.reto7Dias.emocionesAlComer.feliz / 21) * 100"></div>
                  </div>
                  <span class="emotion-count">{{selectedStudent.gameData.reto7Dias.emocionesAlComer.feliz}}</span>
                </div>
                <div class="emotion-item">
                  <span class="emotion-emoji">😐</span>
                  <div class="emotion-bar-bg">
                    <div class="emotion-bar normal" [style.width.%]="(selectedStudent.gameData.reto7Dias.emocionesAlComer.normal / 21) * 100"></div>
                  </div>
                  <span class="emotion-count">{{selectedStudent.gameData.reto7Dias.emocionesAlComer.normal}}</span>
                </div>
                <div class="emotion-item">
                  <span class="emotion-emoji">😢</span>
                  <div class="emotion-bar-bg">
                    <div class="emotion-bar sad" [style.width.%]="(selectedStudent.gameData.reto7Dias.emocionesAlComer.triste / 21) * 100"></div>
                  </div>
                  <span class="emotion-count">{{selectedStudent.gameData.reto7Dias.emocionesAlComer.triste}}</span>
                </div>
                <div class="emotion-item">
                  <span class="emotion-emoji">😰</span>
                  <div class="emotion-bar-bg">
                    <div class="emotion-bar stressed" [style.width.%]="(selectedStudent.gameData.reto7Dias.emocionesAlComer.estresado / 21) * 100"></div>
                  </div>
                  <span class="emotion-count">{{selectedStudent.gameData.reto7Dias.emocionesAlComer.estresado}}</span>
                </div>
                <div class="emotion-item">
                  <span class="emotion-emoji">😬</span>
                  <div class="emotion-bar-bg">
                    <div class="emotion-bar anxious" [style.width.%]="(selectedStudent.gameData.reto7Dias.emocionesAlComer.ansioso / 21) * 100"></div>
                  </div>
                  <span class="emotion-count">{{selectedStudent.gameData.reto7Dias.emocionesAlComer.ansioso}}</span>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Gráfico 6: Concentración Vitaminas y Minerales -->
        <mat-card class="chart-card" *ngIf="selectedStudent.gameData">
          <mat-card-header>
            <mat-card-title>Concentración Vitaminas y Minerales</mat-card-title>
            <span class="data-source">Calculado del Reto 7 Días</span>
          </mat-card-header>
          <mat-card-content>
            <div class="chart-container">
              <div class="vitamin-bars">
                <div class="vitamin-item">
                  <span class="vitamin-label">Vitamina A</span>
                  <div class="vitamin-bar-container">
                    <div class="vitamin-bar" [style.width.%]="selectedStudent.gameData.vitaminas.vitaminaA"
                         [class.good]="selectedStudent.gameData.vitaminas.vitaminaA >= 80"
                         [class.medium]="selectedStudent.gameData.vitaminas.vitaminaA >= 60 && selectedStudent.gameData.vitaminas.vitaminaA < 80"
                         [class.low]="selectedStudent.gameData.vitaminas.vitaminaA < 60"></div>
                  </div>
                  <span class="vitamin-value">{{selectedStudent.gameData.vitaminas.vitaminaA}}%</span>
                </div>
                <div class="vitamin-item">
                  <span class="vitamin-label">Vitamina C</span>
                  <div class="vitamin-bar-container">
                    <div class="vitamin-bar" [style.width.%]="selectedStudent.gameData.vitaminas.vitaminaC"
                         [class.good]="selectedStudent.gameData.vitaminas.vitaminaC >= 80"
                         [class.medium]="selectedStudent.gameData.vitaminas.vitaminaC >= 60 && selectedStudent.gameData.vitaminas.vitaminaC < 80"
                         [class.low]="selectedStudent.gameData.vitaminas.vitaminaC < 60"></div>
                  </div>
                  <span class="vitamin-value">{{selectedStudent.gameData.vitaminas.vitaminaC}}%</span>
                </div>
                <div class="vitamin-item">
                  <span class="vitamin-label">Calcio</span>
                  <div class="vitamin-bar-container">
                    <div class="vitamin-bar" [style.width.%]="selectedStudent.gameData.vitaminas.calcio"
                         [class.good]="selectedStudent.gameData.vitaminas.calcio >= 80"
                         [class.medium]="selectedStudent.gameData.vitaminas.calcio >= 60 && selectedStudent.gameData.vitaminas.calcio < 80"
                         [class.low]="selectedStudent.gameData.vitaminas.calcio < 60"></div>
                  </div>
                  <span class="vitamin-value">{{selectedStudent.gameData.vitaminas.calcio}}%</span>
                </div>
                <div class="vitamin-item">
                  <span class="vitamin-label">Hierro</span>
                  <div class="vitamin-bar-container">
                    <div class="vitamin-bar" [style.width.%]="selectedStudent.gameData.vitaminas.hierro"
                         [class.good]="selectedStudent.gameData.vitaminas.hierro >= 80"
                         [class.medium]="selectedStudent.gameData.vitaminas.hierro >= 60 && selectedStudent.gameData.vitaminas.hierro < 80"
                         [class.low]="selectedStudent.gameData.vitaminas.hierro < 60"></div>
                  </div>
                  <span class="vitamin-value">{{selectedStudent.gameData.vitaminas.hierro}}%</span>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!selectedStudent">
      <mat-icon>person_search</mat-icon>
      <p>Selecciona un estudiante para ver su dashboard</p>
    </div>

  </div>
</div>
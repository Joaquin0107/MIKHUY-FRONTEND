<div class="registro-container">
  <!-- Imágen - Lado izquierdo -->
  <div class="image-section">
    <img [src]="userRole === 'student' ? 'assets/images/students-group.png' : 'assets/images/teacher-classroom.png'" 
         [alt]="userRole === 'student' ? 'Estudiantes' : 'Profesores'" 
         class="registro-image">
    <div class="image-overlay"></div>
    <div class="image-content">
      <h2>Únete a MIKHUY</h2>
      <p *ngIf="userRole === 'student'">Aprende sobre nutrición mientras te diviertes</p>
      <p *ngIf="userRole === 'teacher'">Guía a tus estudiantes hacia hábitos saludables</p>
    </div>
  </div>

  <!-- Formulario - Lado derecho -->
  <div class="form-section">
    <!-- Botón de regreso -->
    <button mat-icon-button class="back-btn" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>

    <div class="form-wrapper">
      <!-- Header -->
      <div class="header-section">
        <img src="assets/images/MIKHUY.png" alt="MIKHUY Logo" class="logo-img">
        <h1 class="title">Crear Cuenta</h1>
        <p class="subtitle">
          <span *ngIf="userRole === 'student'">Registro para Estudiantes</span>
          <span *ngIf="userRole === 'teacher'">Registro para Profesores</span>
        </p>
      </div>

      <!-- Formulario -->
      <form [formGroup]="registroForm" (ngSubmit)="onSubmit()" class="registro-form">
        
        <!-- Datos Personales -->
        <div class="form-section-title">
          <mat-icon>person</mat-icon>
          <span>Datos Personales</span>
        </div>

        <!-- Avatar/Foto (Solo para estudiantes) -->
        <div class="avatar-section" *ngIf="userRole === 'student'">
          <div class="avatar-preview">
            <div class="avatar-circle" [class.has-image]="selectedAvatar">
              <img *ngIf="selectedAvatar" [src]="selectedAvatar" alt="Avatar">
              <mat-icon *ngIf="!selectedAvatar">account_circle</mat-icon>
            </div>
            <button mat-icon-button 
                    *ngIf="selectedAvatar" 
                    class="remove-avatar-btn"
                    type="button"
                    (click)="removeAvatar()">
              <mat-icon>close</mat-icon>
            </button>
          </div>
          <div class="avatar-actions">
            <input type="file" 
                   #avatarInput 
                   accept="image/*" 
                   style="display: none;"
                   (change)="onAvatarSelected($event)">
            <button mat-raised-button 
                    type="button"
                    color="primary"
                    (click)="avatarInput.click()">
              <mat-icon>photo_camera</mat-icon>
              {{selectedAvatar ? 'Cambiar foto' : 'Subir foto'}}
            </button>
            <span class="avatar-hint">Opcional - JPG, PNG (máx. 5MB)</span>
          </div>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Nombres</mat-label>
            <input matInput 
                   type="text" 
                   placeholder="Juan"
                   formControlName="firstName">
            <mat-icon matPrefix>account_circle</mat-icon>
            <mat-error *ngIf="registroForm.get('firstName')?.hasError('required')">
              El nombre es requerido
            </mat-error>
            <mat-error *ngIf="registroForm.get('firstName')?.hasError('minlength')">
              Mínimo 2 caracteres
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Apellidos</mat-label>
            <input matInput 
                   type="text" 
                   placeholder="Pérez"
                   formControlName="lastName">
            <mat-error *ngIf="registroForm.get('lastName')?.hasError('required')">
              El apellido es requerido
            </mat-error>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Correo Electrónico</mat-label>
          <input matInput 
                 type="email" 
                 placeholder="ejemplo@correo.com"
                 formControlName="email">
          <mat-icon matPrefix>email</mat-icon>
          <mat-error *ngIf="registroForm.get('email')?.hasError('required')">
            El correo es requerido
          </mat-error>
          <mat-error *ngIf="registroForm.get('email')?.hasError('email')">
            Ingresa un correo válido
          </mat-error>
        </mat-form-field>

        <!-- Datos Académicos (Estudiantes) -->
        <ng-container *ngIf="userRole === 'student'">
          <div class="form-section-title">
            <mat-icon>school</mat-icon>
            <span>Datos Académicos</span>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Grado</mat-label>
              <mat-select formControlName="grado">
                <mat-option *ngFor="let grado of grados" [value]="grado">
                  {{grado}}
                </mat-option>
              </mat-select>
              <mat-error>Selecciona tu grado</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Sección</mat-label>
              <mat-select formControlName="seccion">
                <mat-option *ngFor="let seccion of secciones" [value]="seccion">
                  Sección {{seccion}}
                </mat-option>
              </mat-select>
              <mat-error>Selecciona tu sección</mat-error>
            </mat-form-field>
          </div>
        </ng-container>

        <!-- Datos Profesionales (Profesores) -->
        <ng-container *ngIf="userRole === 'teacher'">
          <div class="form-section-title">
            <mat-icon>work</mat-icon>
            <span>Datos Profesionales</span>
          </div>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Materia que imparte</mat-label>
            <mat-select formControlName="materia">
              <mat-option *ngFor="let materia of materias" [value]="materia">
                {{materia}}
              </mat-option>
            </mat-select>
            <mat-error>Selecciona una materia</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Años de experiencia</mat-label>
            <input matInput 
                   type="number" 
                   min="0"
                   placeholder="5"
                   formControlName="experiencia">
            <mat-icon matPrefix>timeline</mat-icon>
            <mat-error>Ingresa tus años de experiencia</mat-error>
          </mat-form-field>
        </ng-container>

        <!-- Seguridad -->
        <div class="form-section-title">
          <mat-icon>lock</mat-icon>
          <span>Seguridad</span>
        </div>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Contraseña</mat-label>
          <input matInput 
                 [type]="hidePassword ? 'password' : 'text'"
                 placeholder="Mínimo 6 caracteres"
                 formControlName="password">
          <mat-icon matPrefix>lock</mat-icon>
          <button mat-icon-button 
                  matSuffix 
                  type="button"
                  (click)="togglePasswordVisibility('password')">
            <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
          <mat-error *ngIf="registroForm.get('password')?.hasError('required')">
            La contraseña es requerida
          </mat-error>
          <mat-error *ngIf="registroForm.get('password')?.hasError('minlength')">
            Mínimo 6 caracteres
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirmar Contraseña</mat-label>
          <input matInput 
                 [type]="hideConfirmPassword ? 'password' : 'text'"
                 placeholder="Repite tu contraseña"
                 formControlName="confirmPassword">
          <mat-icon matPrefix>lock_outline</mat-icon>
          <button mat-icon-button 
                  matSuffix 
                  type="button"
                  (click)="togglePasswordVisibility('confirmPassword')">
            <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
          <mat-error *ngIf="registroForm.hasError('passwordMismatch')">
            Las contraseñas no coinciden
          </mat-error>
        </mat-form-field>

        <!-- Términos y condiciones -->
        <div class="terms-section">
          <mat-checkbox formControlName="acceptTerms" color="primary">
            Acepto los <a href="#" class="link">términos y condiciones</a> y la <a href="#" class="link">política de privacidad</a>
          </mat-checkbox>
          <mat-error *ngIf="registroForm.get('acceptTerms')?.hasError('required') && registroForm.get('acceptTerms')?.touched">
            Debes aceptar los términos
          </mat-error>
        </div>

        <!-- Botón de ingreso -->
        <button mat-raised-button 
                type="submit" 
                class="submit-btn"
                [disabled]="!registroForm.valid">
          <mat-icon>person_add</mat-icon>
          Crear Cuenta
        </button>

        <!-- Link de login -->
        <div class="login-link">
          <span>¿Ya tienes cuenta?</span>
          <a (click)="goToLogin()" class="link-btn">Inicia sesión aquí</a>
        </div>
      </form>
    </div>
  </div>
</div>